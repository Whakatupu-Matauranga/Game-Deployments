<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity Web Player | A or O</title>

    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <link rel="manifest" href="manifest.webmanifest">


    <meta name="viewport"
          content="width=device-width, height=device-height,
                   initial-scale=1, maximum-scale=1, user-scalable=no">
  </head>

  <body>
    <div id="unity-container">
      <div id="unity-holder">
        <canvas id="unity-canvas"
                width="450"
                height="800"
                tabindex="-1"></canvas>
      </div>

      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>

      <div id="unity-warning"></div>

    </div>

    <!-- CLEAN UP ANY OLD SERVICE WORKERS / CACHES -->
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
          regs.forEach(r => r.unregister());
        });
        caches.keys().then(keys => {
          keys.forEach(k => caches.delete(k));
        });
      }
    </script>

    <script>
      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");
      var warningBanner = document.querySelector("#unity-warning");

      function unityShowBanner(msg, type) {
        function updateVisibility() {
          warningBanner.style.display =
            warningBanner.children.length ? "block" : "none";
        }
        var div = document.createElement("div");
        div.innerHTML = msg;
        warningBanner.appendChild(div);

        if (type === "error") {
          div.style = "background:red;padding:10px;";
        } else if (type === "warning") {
          div.style = "background:yellow;padding:10px;";
          setTimeout(() => {
            warningBanner.removeChild(div);
            updateVisibility();
          }, 5000);
        }
        updateVisibility();
      }

      /* CHANGE THIS ONLY WHEN YOU WANT TO VERSION BUILDS */
      var buildUrl = "Build";

      var loaderUrl = buildUrl + "/A and O.loader.js";

      var config = {
        arguments: [],
        dataUrl: buildUrl + "/A and O.data",
        frameworkUrl: buildUrl + "/A and O.framework.js",

        codeUrl: buildUrl + "/A and O.wasm",

        streamingAssetsUrl: "StreamingAssets",
        companyName: "Te Wānanga O Raukawa",
        productName: "A or O",
        productVersion: "1.0",

        /* ⚡ FAST + AUTO UPDATE CACHE STRATEGY */
        cacheControl: (url) => {
          if (url.match(/\.data|\.wasm|\.framework\.js/)) {
            return "must-revalidate";
          }
          return "default";
        },

        showBanner: unityShowBanner
      };


      loadingBar.style.display = "block";

      var script = document.createElement("script");
      script.src = loaderUrl;

      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = (100 * progress) + "%";
        }).then(() => {
          loadingBar.style.display = "none";
        }).catch(alert);
      };

      document.body.appendChild(script);
    </script>

    <!-- RESPONSIVE SCALING -->
    <script>
      function scaleGame() {
        const baseWidth = 450;
        const baseHeight = 800;

        const scaleX = window.innerWidth / baseWidth;
        const scaleY = window.innerHeight / baseHeight;

        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const scale = isMobile
          ? Math.max(scaleX, scaleY)
          : Math.min(scaleX, scaleY);

        document.getElementById("unity-holder")
          .style.transform = `scale(${scale})`;
      }

      window.addEventListener("resize", scaleGame);
      window.addEventListener("orientationchange", scaleGame);
      scaleGame();
    </script>

  </body>
</html>
